<html>
	<head>
		<title>MyStock</title>
		<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css">
		<script src="https://code.highcharts.com/adapters/standalone-framework.src.js"></script>
		<script src="https://code.highcharts.com/highcharts.src.js"></script>
		<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>
		<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js"></script>
	</head>

	<body>

		<div class="container">
		  <h3>My Stock</h3>
		  <ul class="nav nav-tabs">
		    <li class="active" id="tab7"><a onclick="showStockChart(7)">One Week</a></li>
		    <!-- <li id="tab30"><a onclick="showStockChart(30)">One Month</a></li>
		    <li id="tab90"><a onclick="showStockChart(90)">Three Months</a></li>
		    <li id="tab180"><a onclick="showStockChart(180)">Half Year</a></li>
		    <li id="tab365"><a onclick="showStockChart(365)">One Year</a></li>
		    <li id="tab730"><a onclick="showStockChart(730)">Two Years</a></li> -->
		  </ul>
		</div>


		<div id="charts" style="display:flex; flex-wrap:wrap;"></div>

		<script type="text/javascript">
			// Default show 1 week
			var currentActiveTab = 'tab7';
			showStockChart(7);

			function showStockChart(numOfDays) {
				// Clear the existing chart first
				$('#charts').empty();

				$.ajax({
					url: 'https://localhost:48520/yahooFinance/' + numOfDays,
					success: function(data, statusCode, jqXHR) {
						console.log(data);
						var polishedData = polishData(data);
						prepareChartPlaceholder(polishedData.length);
						drawChart(polishedData);
					},
					error: function(jqXHR, statusCode, e) {
						console.log(e);
					}
				});

				$('#' + currentActiveTab).removeClass('active');
				currentActiveTab = 'tab' + numOfDays;
				$('#' + currentActiveTab).addClass('active');
			}

			/*
			 rawData is like
			 [  
			   [  
			      {  
			         "date":"2015-05-01T07:00:00.000Z",
			         "open":79.24,
			         "high":79.76,
			         "low":78.11,
			         "close":78.99,
			         "volume":22783300,
			         "adjClose":78.99,
			         "symbol":"FB"
			      }
			   ],
			   [  
			      {  
			         "date":"2015-05-01T07:00:00.000Z",
			         "open":73.37,
			         "high":74.5,
			         "low":72,
			         "close":73.36,
			         "volume":9189500,
			         "adjClose":73.36,
			         "symbol":"CRM"
			      }
			   ]
			]

			 And polish data should be like
			 [  
			   {
				 'symbol' : 'CRM',
				 'price' : '75, 74, 76'
			   }, 
			   {
				 'symbol' : 'FB',
				 'price' : '73, 74, 76'
			   }
			 ]
			 */
			function polishData(rawData) {
				polishedData = [];
				rawData.forEach(function(stockDetail) {
					if (stockDetail.length > 0) {
						var singlePolishData = {
							symbol : stockDetail[0]['symbol'],
							price : []
						}
						stockDetail.forEach(function(singleDayDetail) {
							singlePolishData['price'].push(singleDayDetail['close']);
						})

						polishedData.push(singlePolishData);
					}
				});

				return polishedData;
			}

			function drawChart(data) {
				data.forEach(function(symbolDetail, index) {
					new Highcharts.Chart({
			            chart: {
			                renderTo: "chart"+index
			            },
			            legend: {
			                enabled: true
			            },
			            plotOptions: {
			                series: {
			                    marker: {
			                        enabled: true
			                    },
			                    shadow: true
			                }
			            },
			            series: [{
			                data: symbolDetail['price']
			            }],
			            title: {
			                text: symbolDetail['symbol']
			            },
			            tooltip: {
			                enabled: true
			            }
			        });
				});
			}

			function prepareChartPlaceholder(numberOfChart) {
				var charts = document.getElementById('charts');
				for (var i = 0; i < numberOfChart; i++) {
					var div = document.createElement('div');
					div.setAttribute('id', 'chart'+i);
					div.setAttribute('style', 'width:50%;');
					charts.appendChild(div);
				}
			}
		</script>
	</body>

</html>